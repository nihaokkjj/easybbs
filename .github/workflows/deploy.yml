# 工作流名称，显示在 Actions 标签页
name: Deploy Static Site to GitHub Pages

# ----------------------------------------------------
# 1. 触发条件 (Triggers)
# ----------------------------------------------------
on:
  # 只有推送到 main 分支时才触发部署流程
  push:
    branches:
      - main
  
  # 允许手动在 GitHub 界面上触发
  workflow_dispatch:

# ----------------------------------------------------
# 2. 权限设置
# 必须配置，否则无法进行 Pages 部署
# ----------------------------------------------------
permissions:
  contents: read     # 允许读取仓库内容
  pages: write       # 允许写入 Pages 部署
  id-token: write    # 允许 Pages 部署进行身份验证

# ----------------------------------------------------
# 3. 作业定义 (Jobs)
# ----------------------------------------------------
jobs:
  # Job 1: 构建 (Build) - 负责环境设置、依赖安装和项目打包
  build:
    name: Build Project
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: 检出代码
      - name: Checkout Code
        uses: actions/checkout@v4

      # Step 2: 设置 Node.js 环境
      - name: Setup Node.js Environment
        uses: actions/setup-node@v4
        with:
          node-version: 22 # 根据项目需求调整版本
          cache: 'pnpm'   # 启用 pnpm 缓存
      
      # Step 3: 安装 pnpm
      - name: Install pnpm
        uses: pnpm/action-setup@v3
        with:
          version: 8
          run_install: false

      # Step 4: 安装依赖
      - name: Install Dependencies
        run: pnpm install --frozen-lockfile --no-prefer-workspace
      
      # Step 5: 构建项目
      - name: Build Project
        # ⚠️ 请修改为您的实际构建命令，例如 pnpm run docs:build
        run: pnpm run build 
      
      # Step 6: 配置 GitHub Pages 环境
      - name: Setup Pages
        uses: actions/configure-pages@v5

      # Step 7: 上传构建产物
      - name: Upload Artifact
        uses: actions/upload-pages-artifact@v3
        with:
          # ⚠️ 请确保路径指向您的静态文件构建输出目录
          path: './dist' 

  # Job 2: 部署 (Deploy) - 负责将构建产物部署到 GitHub Pages
  deploy:
    name: Deploy to Pages
    # 依赖于 build Job 成功
    needs: build 
    runs-on: ubuntu-latest
    
      
    steps:
      # Step 1: 部署
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4 # 官方部署 Action