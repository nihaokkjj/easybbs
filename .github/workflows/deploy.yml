# å·¥ä½œæµåç§°ï¼Œæ˜¾ç¤ºåœ¨ Actions æ ‡ç­¾é¡µ
name: Go Build and Release

# ----------------------------------------------------
# 1. è§¦å‘æ¡ä»¶ (Triggers)
# ----------------------------------------------------
on:
  # åªæœ‰æ¨é€åˆ° main åˆ†æ”¯æ—¶æ‰è§¦å‘éƒ¨ç½²æµç¨‹
  push:
    branches:
      - main

# ----------------------------------------------------
# 2. æƒé™è®¾ç½®
# å¿…é¡»é…ç½®ï¼Œå¦åˆ™æ— æ³•è¿›è¡Œ Pages éƒ¨ç½²
# ----------------------------------------------------
permissions:
  contents: read     # å…è®¸è¯»å–ä»“åº“å†…å®¹
  pages: write       # å…è®¸å†™å…¥ Pages éƒ¨ç½²
  id-token: write    # å…è®¸ Pages éƒ¨ç½²è¿›è¡Œèº«ä»½éªŒè¯

# ----------------------------------------------------
# 3. ä½œä¸šå®šä¹‰ (Jobs)
# ----------------------------------------------------
jobs:
  # Job 1: æ„å»º (Build) - è´Ÿè´£ç¯å¢ƒè®¾ç½®ã€ä¾èµ–å®‰è£…å’Œé¡¹ç›®æ‰“åŒ…
  build:
    name: Build Project
    runs-on: ubuntu-latest
    
    steps:
      # Step 1: æ£€å‡ºä»£ç 
      - name: Checkout Code
        uses: actions/checkout@v4

      # Step 2: è®¾ç½® Node.js ç¯å¢ƒ
      - name: Setup Node.js Environment
        uses: actions/setup-node@v4
        with:
          node-version: '20' # æ‚¨çš„é¡¹ç›®ä½¿ç”¨çš„ç‰ˆæœ¬
          cache: 'pnpm'   # å¯ç”¨ pnpm ç¼“å­˜
      
      # âœ… Step 3: ä½¿ç”¨å®˜æ–¹ Action å®‰è£… pnpm
      - name: Install pnpm
        uses: pnpm/action-setup@v3
        with:
          version: '8'
        
      # ğŸ’¡ Step 3.5: å¼ºåˆ¶éªŒè¯ pnpm æ˜¯å¦åœ¨ PATH ä¸­
      # è¿™ä¸€æ­¥æ˜¯ä¸ºäº†ç¡®ä¿ pnpm/action-setup æˆåŠŸæ‰§è¡Œäº† PATH æ³¨å…¥
      - name: Verify pnpm Installation
        run: pnpm --version
        
      # Step 4: å®‰è£…ä¾èµ–
      - name: Install Dependencies
        run: pnpm install --frozen-lockfile --no-prefer-workspace
      
      # Step 5: æ„å»ºé¡¹ç›®
      - name: Build Project
        # å®é™…è¿è¡Œï¼švue-tsc -b && vite build
        run: pnpm run build 
      
      # Step 6: é…ç½® GitHub Pages ç¯å¢ƒ
      - name: Setup Pages
        uses: actions/configure-pages@v5

      # Step 7: ä¸Šä¼ æ„å»ºäº§ç‰©
      - name: Upload Artifact
        uses: actions/upload-pages-artifact@v3
        with:
          # æ‚¨çš„ Vite/Vue é¡¹ç›®é»˜è®¤è¾“å‡ºç›®å½•é€šå¸¸æ˜¯ dist
          path: './dist' 

  # Job 2: éƒ¨ç½² (Deploy) - è´Ÿè´£å°†æ„å»ºäº§ç‰©éƒ¨ç½²åˆ° GitHub Pages
  deploy:
    name: Deploy to Pages
    # ä¾èµ–äº build Job æˆåŠŸ
    needs: build 
    runs-on: ubuntu-latest
    
    # éƒ¨ç½²ç¯å¢ƒå’Œ URL å®šä¹‰
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
      
    steps:
      # Step 1: éƒ¨ç½²
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4 # å®˜æ–¹éƒ¨ç½² Action
